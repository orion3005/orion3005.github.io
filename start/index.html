<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            rel="icon"
            type="image/png"
            sizes="36x36"
            href="favicon-36x36.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="18x18"
            href="favicon-18x18.png"
        />
        <script src="js/main.js"></script>
        <link rel="stylesheet" href="css/main.css" />
        <title>orion@3005</title>
    </head>
    <body onload="traichu()">
        <main>
            <header>
                <section id="date-time">
                    <h2 class="sr-only">Date &amp; Time</h2>
                </section>
                <section id="world-clock">
                    <div class="clock" id="clock-hawaii">
                        <div class="city">HI</div>
                        <div class="time" id="time-hawaii"></div>
                    </div>
                    <div class="clock" id="clock-ny">
                        <div class="city">NYC</div>
                        <div class="time" id="time-ny"></div>
                    </div>
                    <div class="clock" id="clock-london">
                        <div class="city">London</div>
                        <div class="time" id="time-london"></div>
                    </div>
                    <div class="clock" id="clock-china">
                        <div class="city">ä¸­å›½</div>
                        <div class="time" id="time-china"></div>
                    </div>
                </section>
                <section id="weather">
                    <h2 class="sr-only">Location &amp; Weather</h2>
                </section>
            </header>

            <section id="traichu">
                <h1 class="sr-only">_traichu</h1>
                <aside>
                    <img src="Pets_Marshy.png" alt="Sleepy Marshy" />
                    <img src="Pets_Lucius.png" alt="Lucius Watching" />
                </aside>
                <section id="search">
                    <h2 class="sr-only">Search</h2>
                    <form id="search-form" action="#" method="get">
                        <div class="search-container">
                            <input type="text" id="q" name="q" autofocus />
                            <div id="dropdown" class="hidden"></div>
                            <button type="submit" class="sr-only" tabindex="-1">
                                Search
                            </button>
                        </div>
                    </form>
                </section>
                <section id="bookmarks">
                    <h2 class="sr-only">Bookmarks</h2>
                    <ul>
                        <li>
                            <a href="https://mail.proton.me/u/0/inbox"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/mail.proton.me.ico"
                                    class="favicon"
                                    alt="ProtonMail favicon"
                                />Mail</a
                            >
                        </li>
                        <li>
                            <a href="https://calendar.proton.me/u/0/"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/calendar.proton.me.ico"
                                    class="favicon"
                                    alt="ProtonCalendar favicon"
                                />Calendar</a
                            >
                        </li>
                        <li>
                            <a href="https://app.tuta.com/login"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/app.tuta.com.ico"
                                    class="favicon"
                                    alt="Tuta favicon"
                                />Tuta</a
                            >
                        </li>
                    </ul>
                    <ul>
                        <li>
                            <a href="https://openweathermap.org/city/5368361"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/openweathermap.org.ico"
                                    class="favicon"
                                    alt="OpenWeather favicon"
                                />Weather</a
                            >
                        </li>
                        <li>
                            <a href="https://ankiweb.net/decks"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/ankiweb.net.ico"
                                    class="favicon"
                                    alt="Ankiweb favicon"
                                />Anki</a
                            >
                        </li>
                        <li>
                            <a href="https://www.dong-chinese.com/dictionary"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/dong-chinese.com.ico"
                                    class="favicon"
                                    alt="Dong Chinese favicon"
                                />æ‡‚ä¸­æ–‡</a
                            >
                        </li>
                    </ul>
                    <ul>
                        <li>
                            <a
                                href="https://www.openstreetmap.org/#map=5/38.007/-95.844"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/openstreetmap.org.ico"
                                    class="favicon"
                                    alt="OpenStreetMap favicon"
                                />Maps</a
                            >
                        </li>
                        <li>
                            <a href="https://www.github.com"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/github.com.ico"
                                    class="favicon"
                                    alt="Github favicon"
                                />Github</a
                            >
                        </li>
                        <li>
                            <a href="https://chat.onionhost.space:8443"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/chat.onionhost.space.ico"
                                    class="favicon"
                                    alt="OpenGPT favicon"
                                />OpenGPT</a
                            >
                        </li>
                    </ul>
                    <ul>
                        <li>
                            <a href="https://discord.com/channels/@me"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/discord.com.ico"
                                    class="favicon"
                                    alt="Discord favicon"
                                />Discord</a
                            >
                        </li>
                        <li>
                            <a href="https://open.spotify.com/?"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/spotify.com.ico"
                                    class="favicon"
                                    alt="Spotify favicon"
                                />Spotify</a
                            >
                        </li>
                        <li>
                            <a href="https://inv.tux.pizza/feed/subscriptions"
                                ><img
                                    src="https://icons.duckduckgo.com/ip3/youtube.com.ico"
                                    class="favicon"
                                    alt="Youtube favicon"
                                />Invidious</a
                            >
                        </li>
                    </ul>

                    <div id="rss-feed" class="hidden overlay rss-feed-light">
                        <h2>Feed</h2>
                        <div id="rss-content"></div>
                    </div>
                </section>
            </section>
            <section id="extra-features">
                <button id="toggle-rss" class="bottom-left">
                    <span id="rss-icon">ðŸ“¡</span>
                </button>
                <button id="theme-switcher">
                    <span id="theme-icon">â˜€</span>
                </button>
            </section>
        </main>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // Search Bar Integrations
                const searchInput = document.getElementById("q");
                const dropdown = document.getElementById("dropdown");
                const searchOptions = [
                    {
                        key: "d",
                        label: "Search with SearXNG",
                        prefix: "https://search.onionhost.space:8443/search?q=",
                    },
                    {
                        key: "c",
                        label: "Ask ChatGPT",
                        prefix: "https://chatgpt.com/?q=",
                    },
                    {
                        key: "ls",
                        label: "é—®ä¸­æ–‡è€å¸ˆ",
                        prefix: "https://chatgpt.com/g/g-rXpCt4KNz-zhong-wen-lao-shi/?q=",
                    },
                    {
                        key: "lg",
                        label: "Search with LibGen",
                        prefix: "http://libgen.rs/search.php?req=",
                    },
                    {
                        key: "ar",
                        label: "Search with archive.org",
                        prefix: "https://archive.org/search.php?query=",
                    },
                    {
                        key: "g",
                        label: "Search with Google",
                        prefix: "https://www.google.com/search?q=",
                    },
                    {
                        key: "wp",
                        label: "Search with Wikipedia",
                        prefix: "https://en.wikipedia.org/w/index.php?search=",
                    },
                    {
                        key: "b",
                        label: "Search with Baidu",
                        prefix: "https://www.baidu.com/s?wd=",
                    },
                ];
                let currentMode = "";
                let prefix = "";
                let selectedIndex = -1;

                searchInput.addEventListener("keydown", (event) => {
                    if (event.key === "Tab") {
                        event.preventDefault(); // Prevent default tab behavior
                        selectedIndex =
                            (selectedIndex + 1) % searchOptions.length;
                        updateDropdown();
                    }
                });

                searchInput.addEventListener("input", () => {
                    const query = searchInput.value.trim().toLowerCase();
                    const matchedOption = searchOptions.find((option) =>
                        query.startsWith(option.key),
                    );
                    if (matchedOption) {
                        currentMode = matchedOption.key;
                        prefix = matchedOption.prefix;
                        selectedIndex = searchOptions.indexOf(matchedOption);
                        updateDropdown();
                    } else {
                        currentMode = "";
                        prefix = "";
                        selectedIndex = -1;
                        updateDropdown();
                    }
                });

                searchInput.addEventListener("focus", updateDropdown);

                function updateDropdown() {
                    if (searchInput.value.trim()) {
                        dropdown.innerHTML = searchOptions
                            .map(
                                (option, index) => `
                            <div class="${index === selectedIndex ? "selected" : ""}" data-index="${index}">${option.label}</div>
                        `,
                            )
                            .join("");
                        dropdown.classList.remove("hidden");
                    } else {
                        dropdown.classList.add("hidden");
                    }
                }

                document.addEventListener("click", (event) => {
                    if (
                        !searchInput.contains(event.target) &&
                        !dropdown.contains(event.target)
                    ) {
                        dropdown.classList.add("hidden");
                    }
                });

                document
                    .getElementById("search-form")
                    .addEventListener("submit", (event) => {
                        event.preventDefault();
                        let query = searchInput.value.trim();
                        if (selectedIndex !== -1) {
                            window.location.href =
                                searchOptions[selectedIndex].prefix +
                                encodeURIComponent(query);
                        } else {
                            window.location.href =
                                "https://search.onionhost.space:8443/search?q=" +
                                encodeURIComponent(query);
                        }
                    });

                // Add click event to dropdown items
                dropdown.addEventListener("click", (event) => {
                    const clickedItem = event.target;
                    const index = clickedItem.getAttribute("data-index");
                    if (index !== null) {
                        selectedIndex = parseInt(index, 10);
                        const selectedOption = searchOptions[selectedIndex];
                        currentMode = selectedOption.key;
                        prefix = selectedOption.prefix;
                        searchInput.focus();
                        updateDropdown();
                    }
                });

                // Highlight on hover
                dropdown.addEventListener("mouseover", (event) => {
                    const hoveredItem = event.target;
                    const index = hoveredItem.getAttribute("data-index");
                    if (index !== null) {
                        selectedIndex = parseInt(index, 10);
                        updateDropdown();
                    }
                });
                // Time Zone Clock Update
                function updateTime() {
                    const timeZones = {
                        "clock-china": "Asia/Shanghai",
                        "clock-ny": "America/New_York",
                        "clock-london": "Europe/London",
                        "clock-hawaii": "Pacific/Honolulu",
                    };

                    for (const [id, timeZone] of Object.entries(timeZones)) {
                        const date = new Date().toLocaleString("en-US", {
                            timeZone,
                            hour: "numeric",
                            minute: "numeric",
                            hour12: false,
                        });
                        document.getElementById(
                            `time-${id.split("-")[1]}`,
                        ).textContent = date;
                    }
                }

                setInterval(updateTime, 1000);
                updateTime();

                // Theme Switching
                const themeSwitcher = document.getElementById("theme-switcher");
                const themeIcon = document.getElementById("theme-icon");
                const rssFeedContainer = document.getElementById("rss-feed");
                const currentTheme =
                    localStorage.getItem("theme") || "light-mode";

                document.body.classList.add(currentTheme);
                themeIcon.textContent =
                    currentTheme === "light-mode" ? "â˜€" : "â˜½";
                rssFeedContainer.classList.add(
                    currentTheme === "light-mode"
                        ? "rss-feed-light"
                        : "rss-feed-dark",
                );

                themeSwitcher.addEventListener("click", () => {
                    const isLightMode =
                        document.body.classList.contains("light-mode");
                    const newTheme = isLightMode ? "dark-mode" : "light-mode";
                    document.body.classList.remove("light-mode", "dark-mode");
                    document.body.classList.add(newTheme);
                    localStorage.setItem("theme", newTheme);
                    themeIcon.textContent =
                        newTheme === "light-mode" ? "â˜€" : "â˜½";
                    rssFeedContainer.classList.toggle("rss-feed-light");
                    rssFeedContainer.classList.toggle("rss-feed-dark");
                });

                // RSS Feed
                const rssFeedUrl = "https://rss2json.com/api.json?rss_url=";
                const feedUrl =
                    "https://old.reddit.com/user/my-stinky-toes/m/basketball.rss"; // Replace with your RSS feed URL
                let feedItems = [];
                let currentFeedIndex = 0;
                const itemsPerPage = 5;

                function loadRSSFeed() {
                    fetch(rssFeedUrl + encodeURIComponent(feedUrl))
                        .then((response) => response.json())
                        .then((data) => {
                            if (data.status !== "ok") {
                                throw new Error("Error fetching RSS feed");
                            }
                            feedItems = data.items;
                            currentFeedIndex = 0; // Reset index
                            displayRSSFeed();
                            setupIntersectionObserver();
                        })
                        .catch((error) =>
                            console.error("Error loading RSS feed:", error),
                        );
                }

                function displayRSSFeed() {
                    const rssContent = document.getElementById("rss-content");
                    const itemsToDisplay = feedItems.slice(
                        currentFeedIndex,
                        currentFeedIndex + itemsPerPage,
                    );
                    rssContent.innerHTML += itemsToDisplay
                        .map(
                            (item) => `
                                <div class="rss-item">
                                    <h3><a href="${item.link}" target="_blank">${item.title}</a></h3>
                                    <p>${item.description}</p>
                                </div>
                            `,
                        )
                        .join("");
                    currentFeedIndex += itemsPerPage;
                }

                function setupIntersectionObserver() {
                    const rssContent = document.getElementById("rss-content");
                    const observer = new IntersectionObserver(
                        (entries) => {
                            entries.forEach((entry) => {
                                if (entry.isIntersecting) {
                                    observer.unobserve(entry.target);
                                    if (currentFeedIndex < feedItems.length) {
                                        displayRSSFeed();
                                        observer.observe(
                                            rssContent.lastElementChild,
                                        );
                                    }
                                }
                            });
                        },
                        { root: null, rootMargin: "0px", threshold: 1.0 },
                    );

                    if (rssContent.lastElementChild) {
                        observer.observe(rssContent.lastElementChild);
                    }
                }

                // Toggle RSS feed visibility and load content
                document
                    .getElementById("toggle-rss")
                    .addEventListener("click", () => {
                        toggleVisibility("rss-feed");
                        loadRSSFeed();
                    });

                // Function to toggle visibility
                function toggleVisibility(elementId) {
                    const element = document.getElementById(elementId);
                    element.classList.toggle("hidden");
                }
            });
        </script>
    </body>
</html>
